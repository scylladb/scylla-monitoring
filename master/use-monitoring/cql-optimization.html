

<!DOCTYPE html>
<html class="no-js" lang="en" style="visibility: hidden;">
    
    

    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width initial-scale=1" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <title>
             The CQL Optimization | ScyllaDB Docs 
        </title>
        <meta name="description" content="Scylla Monitoring Stack is a full stack for Scylla monitoring and alerting. The stack contains open source tools including Prometheus and Grafana, as well as custom Scylla dashboards and tooling." />
        <link rel="icon" href="../_static/img/favicon.ico" type="image/x-icon" />
        <link rel="icon" href="../_static/img/favicon-32x32.png" sizes="32x32" />
        <link rel="icon" href="../_static/img/favicon-228x228.png" sizes="192x192" />
        <link rel="apple-touch-icon" href="../_static/img/favicon-228x228.png" />
        <meta name="msapplication-TileImage" href="../_static/img/favicon-228x228.png" />

        
            
            
        

        
            
            <link rel="canonical" href="https://monitoring.docs.scylladb.com/stable/use-monitoring/cql-optimization.html"/>
        

        <link rel="author" href="mailto:info@scylladb.com" />

        
            
        <!-- increase expertrec loading priority-->
        <link rel="dns-prefetch" href="https://cse.expertrec.com">

        <!-- increase font loading priority -->
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
        <link rel="preload" as="style"
              href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400&display=swap" />

        <!-- async CSS -->
        <link rel="stylesheet" media="print" onload="this.onload=null;this.removeAttribute('media');"
              href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400&display=swap" />

        <!-- no-JS fallback -->
        <noscript>
            <link rel="stylesheet"
                  href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;0,700;1,400&display=swap" />
        </noscript>

        
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/biel-search@latest/dist/biel-search/biel-search.css">
            <script type="module" src="https://cdn.jsdelivr.net/npm/biel-search@latest/dist/biel-search/biel-search.esm.js"></script>
        

        
            
                <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
            
        
            
                <link rel="stylesheet" type="text/css" href="../_static/css/main.css?v=0ebb4bd5" />
            
        
            
                <link rel="stylesheet" type="text/css" href="../_static/sphinx_collapse.css?v=226d88b4" />
            
        
            
                <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
            
        
    
        
        
            
        <script type="text/javascript" src="../_static/js/runtime.bundle.js"></script>
        <script type="text/javascript" src="../_static/js/main.bundle.js"></script>
        
            
                <script src="../_static/documentation_options.js?v=5929fcd5"></script>
            
        
            
                <script src="../_static/doctools.js?v=9a2dae69"></script>
            
        
            
                <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
            
        
            
                <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
            
        
            
                <script src="../_static/copybutton.js?v=f281be69"></script>
            
        
    
            
                <!-- Local meta tags -->
            
            
                <!-- Google Tag Manager docs -->
<script>
    (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({
            "gtm.start": new Date().getTime(),
            event: "gtm.js"
        });
        var f = d.getElementsByTagName(s)[0],
            j = d.createElement(s),
            dl = l != "dataLayer" ? "&l=" + l : "";
        j.async = true;
        j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
        f.parentNode.insertBefore(j, f);
    })(window, document, "script", "dataLayer", "GTM-54NWVS4");
</script>
<!-- End Google Tag Manager -->

<!-- Google Tag Manager global -->
<script>
    (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({
            "gtm.start": new Date().getTime(),
            event: "gtm.js"
        });
        var f = d.getElementsByTagName(s)[0],
            j = d.createElement(s),
            dl = l != "dataLayer" ? "&l=" + l : "";
        j.async = true;
        j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
        f.parentNode.insertBefore(j, f);
    })(window, document, "script", "dataLayer", "GTM-T8P2JP");
</script>
<!-- End Google Tag Manager -->

<!-- Expertrec -->
<script>
    var id = "e2077224-9ccf-11e9-a0c9-0242ac130002";
    var ci_search = document.createElement("script");
    ci_search.type = "text/javascript";
    ci_search.async = true;
    ci_search.src = "https://cse.expertrec.com/api/js/ci_common.js?id=" + id;
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(ci_search, s);
</script>
<!-- End Expertrec -->
            
        
    </head>

    <body class="brand-product">
        <section class="promo-banner  promo-banner--hide" style="display: none;">
    <div class="promo-banner-wrapper">
        <div class="promo-banner__content">
            
            <div class="promo-banner__title">ScyllaDB University Live | Free Virtual Training Event</div>
            <a class="promo-banner__button button button--reverse" href="#"
               target="_blank" rel="noopener noreferrer">Learn more</a>
        </div>
        <button class="promo-banner__close">
            <i class="icon-cancel"></i>
        </button>
    </div>
</section>
        <header class="header">
    <div class="header-logo">
        <a class="header-logo__img" href="https://scylladb.com/">
            <img src="../_static/img/scylladb-logo-horizontal.svg" alt="ScyllaDB Documentation Logo" />
        </a>
        <span class="header-logo__bar"></span>
        <a class="header-logo__text" href="https://docs.scylladb.com/">
            Documentation
        </a>
    </div>
    <div class="header-navigation">
        <ul class="dropdown menu scylla-dropdown scylla-dropdown--header" data-dropdown-menu>
            <li class="scylla-dropdown__item">
                <a href="#" class="scylla-dropdown__title">Deployments <i class="chevron icon-arrow-dropdown"></i></a>
                <ul class="menu scylla-dropdown__content">
                    <li>
                        <a href="https://docs.scylladb.com/scylla-cloud/">
                            <i class="icon-docs-cloud"></i>Cloud</a>
                    </li>
                    <li>
                        <a href="https://docs.scylladb.com/manual/">
                            <i class="icon-server"></i>Server</a>
                    </li>
                </ul>
            </li>
            <li class="scylla-dropdown__item">
                <a href="#" class="scylla-dropdown__title">Tools <i class="chevron icon-arrow-dropdown"></i></a>
                <ul class="menu scylla-dropdown__content">
                    <li>
                        <a href="https://manager.docs.scylladb.com/">
                            <i class="icon-docs-manager"></i>ScyllaDB Manager</a>
                    </li>
                    <li>
                        <a href="https://monitoring.docs.scylladb.com/">
                            <i class="icon-docs-monitoring"></i>ScyllaDB
                            Monitoring Stack</a>
                    </li>
                    <li>
                        <a href="https://operator.docs.scylladb.com/">
                            <i class="icon-docs-operator"></i>ScyllaDB Operator
                        </a>
                    </li>
                </ul>
            </li>
            <li class="scylla-dropdown__item">
                <a href="#" class="scylla-dropdown__title">Drivers <i class="chevron icon-arrow-dropdown"></i></a>
                <ul class="menu scylla-dropdown__content">
                    <li>
                        <a href="https://docs.scylladb.com/stable/drivers/cql-drivers">
                            <i class="icon-docs-nsql-guides"></i>CQL Drivers
                        </a>
                    </li>
                    <li>
                        <a href="https://docs.scylladb.com/stable/drivers/dynamo-drivers">
                            <i class="icon-docs-alternator"></i>DynamoDB Drivers
                        </a>

                        <li>
                            <a href="https://docs.scylladb.com/stable/versioning/driver-support">
                                <i class="icon-docs-blog"></i>Supported Driver Versions
                            </a>
                        </li>
                    </li>
                </ul>
            </li>
            <li class="scylla-dropdown__item">
                <a href="#" class="scylla-dropdown__title">Resources
                    <i class="chevron icon-arrow-dropdown"></i></a>
                <ul class="menu scylla-dropdown__content">
                    <li>
                        <a href="https://university.scylladb.com">
                            <i class="icon-university"></i>
                            ScyllaDB University
                        </a>
                    </li>
                    <li>
                        <a href="https://forum.scylladb.com">
                            <i class="icon-docs-community"></i>
                            Community Forum
                        </a>
                    </li>
                    <li>
                        <a href="https://docs.scylladb.com/stable/get-started/develop-with-scylladb/tutorials-example-projects.html">
                            <i class="icon-docs-training"></i>
                            Tutorials
                        </a>
                    </li>
                </ul>
            </li>
        </ul>
        <div class="header-button">
            <a href="https://docs.scylladb.com/manual/stable/getting-started/installation-common/scylla-web-installer.html" class="button"><i class="icon-download me-2"></i> Install</a>
        </div>
    </div>
    <div class="header-search-box">
        <i class="dark-theme-toggler icon-theme"></i>
        <div class="search-box">
            <ci-search></ci-search>
        </div>
        
            <biel-button class="header-ask-ai" project="ddfdo8m94k"
                         header-title="ScyllaDB chatbot (beta)"
                         button-position="default"
                         modal-position="bottom-right"
                         button-style="dark">
                Ask AI
            </biel-button>
        
    </div>
    <div class="side-nav-toggle">
    <i class="dark-theme-toggler icon-theme"></i>
    <div class="side-nav-toggle__button" data-toggle="side-nav">
        <i class="icon-menu"></i>
    </div>
</div>
</header>
        <div class="title"></div>
        <section
            class="layout  layout--sidebar layout--has-secondary-sidebar ">
            <div class="content large-order-2">
                
                    <div class="pre-content">
                        <div class="breadcrumbs">
    <span class="bread__item">
        <a href="https://docs.scylladb.com"
           class="bread__highlight">
            <i class="icon-home"></i> ScyllaDB Docs
        </a>
    </span>
    <span class="bread__item">
        <a href="../index.html"
           class="bread__highlight">
            ScyllaDB Monitoring
        </a>
    </span>
    
        <span class="bread__item">
            <a href="index.html" class="bread__highlight">
                Using Scylla Monitoring Stack
            </a>
        </span>
    
    <span class="bread__item bread__item--last">The CQL Optimization</span>
</div>
                    </div>
                
                
                    <div class="sidebar-right-layout">
                        <div class="body-container">
                

                <div class="content-body">
                    
                        
    <div class="admonition caution">
        <p class="admonition-title">Caution</p>
        <p>
            
                You're viewing documentation for an unstable version of ScyllaDB Monitoring.
            
            <a href="../../stable/use-monitoring/cql-optimization.html">Switch to the latest stable version.</a>
        </p>
    </div>

                    

                    <section id="the-cql-optimization">
<h1>The CQL Optimization<a class="headerlink" href="#the-cql-optimization" title="Link to this heading">¶</a></h1>
<p>The CQL Optimization is part of the CQL Dashboard and is a tool to help identify potential issues with queries, data model and driver.</p>
<figure class="align-default" id="id2">
<img alt="../_images/cql_optimization_master.png" src="../_images/cql_optimization_master.png" />
<figcaption>
<p><span class="caption-text"><strong>The CQL Dashboard</strong></span><a class="headerlink" href="#id2" title="Link to this image">¶</a></p>
</figcaption>
</figure>
<p>The upper part of the dashboard holds CQL related metrics.</p>
<p>The lower parts holds gauges and graphs. When inspecting the system, we like the gauge to be near zero and the graphs as low as possible.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Besides your queries, there are queries generated by the cql driver and internal queries to the system tables which can be misleading when testing with low traffic.</p>
</div>
<p>The following sections describe each of the dashboard’s panel</p>
<section id="prepared-statements">
<h2>Prepared Statements<a class="headerlink" href="#prepared-statements" title="Link to this heading">¶</a></h2>
<p><a class="reference external" href="https://docs.scylladb.com/getting-started/definitions/#prepared-statements">Prepared statements</a> are queries that are first defined as a template with place holders for the values and then that template is used
multiple times with different values.</p>
<p>Using prepared statements has the following benefits:</p>
<ul class="simple">
<li><p>The database only needs to parse the query once</p></li>
<li><p>The driver can route the query to the right node</p></li>
<li><p>Using place-holders and values is safer and prevents CQL-Injection</p></li>
</ul>
<p>The <strong>CQL Non-Prepared Queries</strong> Gauge shows the percentage of queries that are not prepared.</p>
<p>The <strong>CQL Non-Prepared Queries</strong> Graph shows the rate of the queries. Make sure both are low.</p>
</section>
<section id="token-aware">
<h2>Token Aware<a class="headerlink" href="#token-aware" title="Link to this heading">¶</a></h2>
<p>Scylla is a distributed database, where each node contains only part of the data, specifically a range of the token ring.
Ideally, a query would reach the node that holds the data (one of the replicas), failing to do so would mean the coordinator
needs to send the query internally to a replica. This results in higher latency and increased resource usage.</p>
<p>Typically, your driver would know how to route the queries to a replication node, but using non-prepared statements, non-token-aware driver
or load-balance can cause the query to reach a node that is not a replica.</p>
<p>The <strong>Non-Token Aware</strong> Gauge shows the percentage of queries that reached a node that does not hold that data (a node that is not a replica-node).</p>
<p>The <strong>Non-Token Aware Queries</strong> Graph shows the rate of the queries that did not reach a replica-node, make sure both are low.</p>
</section>
<section id="paged-queries">
<h2>Paged Queries<a class="headerlink" href="#paged-queries" title="Link to this heading">¶</a></h2>
<p>By default, read queries are paged, this means that Scylla will break the results into multiple chunks limiting the reply size.
Non-Paged queries require all results be returned in one result increasing the overall load of the system and clients and should be avoided.</p>
<p>The <strong>Non-Paged CQL Reads</strong> Gauge shows the percentage of non-paged read queries that did not use paging.</p>
<p>The <strong>Non-Paged CQL Reads</strong> Graph shows the rate of the non-paged queries, make sure both are low.</p>
</section>
<section id="reversed-cql-reads">
<h2>Reversed CQL Reads<a class="headerlink" href="#reversed-cql-reads" title="Link to this heading">¶</a></h2>
<p>ScyllaDB supports compound primary keys with a clustering column. This kind of primary keys allows an efficient way
to return sorted results that are sorted by the clustering column.</p>
<p>We strongly recommend using use the correct ordering.
Querying with an order different than the order the <code class="docutils literal notranslate"><span class="pre">CLUSTERING</span> <span class="pre">ORDER</span> <span class="pre">BY</span></code> was defined is supported, but not advisable.</p>
<p>For example, look at the following table:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>CREATE<span class="w"> </span>TABLE<span class="w"> </span>ks1.table_demo<span class="w"> </span><span class="o">(</span>
<span class="w">   </span>category<span class="w"> </span>text,
<span class="w">   </span><span class="nb">type</span><span class="w"> </span>int,
<span class="w">   </span>PRIMARY<span class="w"> </span>KEY<span class="w"> </span><span class="o">(</span>category,<span class="w"> </span><span class="nb">type</span><span class="o">))</span>
WITH<span class="w"> </span>CLUSTERING<span class="w"> </span>ORDER<span class="w"> </span>BY<span class="w"> </span><span class="o">(</span><span class="nb">type</span><span class="w"> </span>DESC<span class="o">)</span><span class="p">;</span>
</pre></div>
</div>
<p>The following query uses reverse order:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="k">select</span><span class="w"> </span>*<span class="w"> </span>from<span class="w"> </span>ks1.table_demo<span class="w"> </span>where<span class="w"> </span><span class="nv">category</span><span class="o">=</span><span class="s1">&#39;cat1&#39;</span><span class="w"> </span>order<span class="w"> </span>by<span class="w"> </span><span class="nb">type</span><span class="w"> </span>ASC<span class="p">;</span>
</pre></div>
</div>
<p>The <strong>Reversed CQL Reads</strong> Gauge shows the percentage of read queries that use <code class="docutils literal notranslate"><span class="pre">ORDER</span> <span class="pre">BY</span></code> that is different than the <code class="docutils literal notranslate"><span class="pre">CLUSTERING</span> <span class="pre">ORDER</span> <span class="pre">BY</span></code>.</p>
<p>The <strong>Reversed CQL Reads</strong> Graph shows the rate of the read queries that use <code class="docutils literal notranslate"><span class="pre">ORDER</span> <span class="pre">BY</span></code> that is different than the <code class="docutils literal notranslate"><span class="pre">CLUSTERING</span> <span class="pre">ORDER</span> <span class="pre">BY</span></code>, make sure both are low.</p>
</section>
<section id="allow-filtering">
<h2>ALLOW FILTERING<a class="headerlink" href="#allow-filtering" title="Link to this heading">¶</a></h2>
<p>Scylla supports server side data filtering that is not based on the primary key. This means Scylla would read data and then filter and
return part of it to the user. Data that is read and then filtered is an overhead to the system.</p>
<p>These kinds of queries can create a big load on the system, and should be used with care.</p>
<p>The CQL optimization dashboard, checks for two things related to queries that use <code class="docutils literal notranslate"><span class="pre">ALLOW</span> <span class="pre">FILTERING</span></code>: how many such queries exist; and how much of the data that was read was
dropped before returning to the client.</p>
<p>The <strong>ALLOW FILTERING CQL Reads</strong> Gauge shows the percentage of read queries that use <code class="docutils literal notranslate"><span class="pre">ALLOW</span> <span class="pre">FILTERING</span></code>.</p>
<p>The <strong>ALLOW FILTERING CQL Reads</strong> Graph shows the rate of the read queries that use <code class="docutils literal notranslate"><span class="pre">ALLOW</span> <span class="pre">FILTERING</span></code>, make sure both are low.</p>
<p>The <strong>ALLOW FILTERING Filtered Rows</strong> Gauge shows the percentage of rows that were read and then filtered, this is an indication of the additional overhead to the system.</p>
<p>The <strong>ALLOW FILTERING Filtered Rows</strong> Graph shows multiple graphs: the rows that were read, the rows that matched and the rows that were dropped. Rows that
were dropped are an additional overhead to the system.</p>
</section>
<section id="consistency-level">
<h2>Consistency Level<a class="headerlink" href="#consistency-level" title="Link to this heading">¶</a></h2>
<p>Typically data in Scylla is duplicated into multiple replicas for availability reasons. A coordinator node would get the request and will send it
to the nodes holding the replicas.</p>
<p>The query Consistency Level determines how many replies from the replicas are required before the coordinator replies to the client.
The most common case is to use QUORUM, which means that when the coordinator gets a majority of the replies from the replicas, it will return success to the client.</p>
<p>Two consistency levels hold a potential problem and should be used with care <code class="docutils literal notranslate"><span class="pre">ANY</span></code> and <code class="docutils literal notranslate"><span class="pre">ALL</span></code>.</p>
<p>The <strong>CQL ANY Queries</strong> Gauge shows the percentage of queries that use Consistency Level <code class="docutils literal notranslate"><span class="pre">ANY</span></code>. Using consistency level ANY in a query may hurt persistency, if the node receiving the request fails, the data may be lost.</p>
<p>The <strong>CQL ANY CL Queries</strong> Graph shows the rate of the queries that use Consistency Level <code class="docutils literal notranslate"><span class="pre">ANY</span></code>, make sure both are low.</p>
<p>The <strong>CQL ALL CL Queries</strong> Gauge shows the percentage of queries that use Consistency Level <code class="docutils literal notranslate"><span class="pre">ALL</span></code>. Using consistency level ALL in a query may hurt availability, if a node is unavailable the operations will fail.</p>
<p>The <strong>CQL ALL CL Queries</strong> Graph shows the rate of the queries that use Consistency Level <code class="docutils literal notranslate"><span class="pre">ALL</span></code>, make sure both are low.</p>
</section>
<section id="cross-dc">
<h2>Cross DC<a class="headerlink" href="#cross-dc" title="Link to this heading">¶</a></h2>
<p>Cross DC traffic is usually more expensive in terms of latencies and cost.
This metric reports on such traffic in situations were it could be avoided.</p>
</section>
<section id="cross-dc-consistency-level">
<h2>Cross DC Consistency Level<a class="headerlink" href="#cross-dc-consistency-level" title="Link to this heading">¶</a></h2>
<p>Using consistency level QUORUM or consistency level ONE in a query when there is more than one DC may hurt performance,
as queries may end in the non-local DC. Use LOCAL_QUORUM and LOCAL_ONE instead.</p>
</section>
<section id="cross-dc-read-requests">
<h2>Cross DC read requests<a class="headerlink" href="#cross-dc-read-requests" title="Link to this heading">¶</a></h2>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The CQL Optimization Dashboard relies on the definition of nodes per Data Center in the Scylla Monitoring Stack (prometheus/scylla_servers.yml) to match the Data Center names used in Scylla Cluster.
If this is not the case, you will see the wrong result.</p>
</div>
<p>In a typical situation, a client performs a read from the nearest data-center and that query is performed local to the data-center.
A read request that ends up causing traffic between data-centers adds additional overhead to the system.</p>
<p>The <strong>Cross DC read requests</strong> Gauge shows the percentage of read queries that caused a request to an external data-center, make sure it is low or zero.</p>
</section>
</section>

                </div>
                
                    <div class="post-content">
                        
    <div class="feedback-container">
        <p class="feedback-container__title">Was this page helpful?</p>
        <span data-tooltip tabindex="1" title="Yes" data-position="top">
            <button class="feedback-container__button" id="feedback-positive">
                <i class="feedback-container__icon icon-docs-thumbs-up"></i>
            </button>
        </span>
        <span data-tooltip tabindex="1" title="No" data-position="top">
            <button class="feedback-container__button" id="feedback-negative">
                <i class="feedback-container__icon icon-docs-thumbs-down"></i>
            </button>
        </span>
        <div class="feedback-container__message" id="feedback-message"></div>
    </div>

    <script>
        function resetFeedbackButtonActive() {
            const feedbackButtons = document.getElementsByClassName('feedback-container__button');
            for (let i = 0; i < feedbackButtons.length; i++) {
                feedbackButtons[i].classList.remove('active');
            }
        }

        function showMessage(liked) {
            const feedbackMessage = document.getElementById('feedback-message');
            const themeGithubRepository = true;
            let message = 'Great! Thanks for your feedback.';
            if (themeGithubRepository && !liked) {
                message = "Thanks for your feedback! Please don't hesitate to <a href='https://github.com/scylladb/scylla-monitoring/issues/new?title=docs:%20Issue on page The CQL Optimization&&body=I%20would%20like%20to%20report%20an%20issue%20on%20page%20https://monitoring.docs.scylladb.com/master/use-monitoring/cql-optimization%0A%0A%23%23%23%20Problem%0A%0A%23%23%23%20%20Suggest%20a%20fix&labels=documentation'>create an issue</a> if you have any suggestions on how we can improve.";
            }
            feedbackMessage.innerHTML = message;
        }

        function sendGaEvent(liked) {
            const event_label = liked ? "positive" : "negative";
            const event = "feedback_" + event_label;
            window.dataLayer = window.dataLayer || [];
            window.dataLayer.push({
                'event': event,
            });
        }

        const positiveFeebackButton = document.getElementById('feedback-positive');
        const negativeFeedbackButton = document.getElementById('feedback-negative');

        positiveFeebackButton.addEventListener('click', function() {
            resetFeedbackButtonActive();
            sendGaEvent(true);
            showMessage(true);
            positiveFeebackButton.classList.add('active');
        });

        negativeFeedbackButton.addEventListener('click', function() {
            resetFeedbackButtonActive();
            sendGaEvent(false);
            showMessage(false);
            negativeFeedbackButton.classList.add('active');
        });
    </script>

                        <div class="content-navigation">
    <div class="navigation navigation--prev">
        
            <a class="navigation__link" href="index.html">
                <button class="navigation__button">
                    <i class="icon-chevron-left"></i>
                </button>
                <div class="navigation__title">
                    <span class="colored">PREVIOUS</span> <br />Using Scylla Monitoring Stack
                </div>
            </a>
        
    </div>
    <div class="navigation navigation--next">
        
            <a class="navigation__link" href="advisor/index.html">
                <div class="navigation__title">
                    <span class="colored">NEXT</span> <br />Scylla Monitoring Stack Advisor
                </div>
                <button class="navigation__button">
                    <i class="icon-chevron-right"></i>
                </button>
            </a>
        
    </div>
</div>
                        <!-- Post content text -->
                    </div>
                

                
                    </div>
                    <div class="sidebar-right large-order-3">
                        <div class="secondary-side-nav custom-scroll-bar">
    
    <ul class="contribute">
        <li class="contribute__item">
            <a class="button button-sm" href="https://github.com/scylladb/scylla-monitoring/issues/new?title=docs:%20Issue on page The CQL Optimization&&body=I%20would%20like%20to%20report%20an%20issue%20on%20page%20https://monitoring.docs.scylladb.com/master/use-monitoring/cql-optimization%0A%0A%23%23%23%20Problem%0A%0A%23%23%23%20%20Suggest%20a%20fix&labels=documentation"
               target="_blank">
                <i class="icon-github" aria-hidden="true"></i>Create an issue
            </a>
        </li>
        
            <li class="contribute__item">
                <a class="button button-sm" href="https://github.com/scylladb/scylla-monitoring/edit/master/docs/source/use-monitoring/cql-optimization.rst"
                   target="_blank">
                    <i class="icon-edit" aria-hidden="true"></i>Edit this page
                </a>
            </li>
        
    </ul>

    
        <div class="secondary-side-nav__content">
            <p class="topic-title">On this page</p>
            <ul>
<li><a class="reference internal" href="#">The CQL Optimization</a><ul>
<li><a class="reference internal" href="#prepared-statements">Prepared Statements</a></li>
<li><a class="reference internal" href="#token-aware">Token Aware</a></li>
<li><a class="reference internal" href="#paged-queries">Paged Queries</a></li>
<li><a class="reference internal" href="#reversed-cql-reads">Reversed CQL Reads</a></li>
<li><a class="reference internal" href="#allow-filtering">ALLOW FILTERING</a></li>
<li><a class="reference internal" href="#consistency-level">Consistency Level</a></li>
<li><a class="reference internal" href="#cross-dc">Cross DC</a></li>
<li><a class="reference internal" href="#cross-dc-consistency-level">Cross DC Consistency Level</a></li>
<li><a class="reference internal" href="#cross-dc-read-requests">Cross DC read requests</a></li>
</ul>
</li>
</ul>

        </div>
    
</div>
                    </div>
                    </div>
                
            </div>
            <div class="sidebar-left  large-order-1">
                
                    
                        <div id="side-nav" class="side-nav custom-scroll-bar" data-closable data-toggler=".show">
    <button class="collapsible-button">
        <i class="icon-docs-menu-collapse"></i>
    </button>
    <div class="side-nav-content custom-scroll-bar">
        <div class="side-nav__title">
            <a href="../index.html">ScyllaDB Monitoring</a>
        </div>
        <div class="side-nav__search">
            <div class="search-box">
                <ci-search></ci-search>
            </div>
        </div>
        <div class="side-nav__versions"><ul class="dropdown menu scylla-dropdown scylla-dropdown--versions" data-dropdown-menu>
    <li class="scylla-dropdown__item">
        <a class="scylla-dropdown__title" href="#">
            
                master
            
            <i class="chevron icon-docs-chevron-right"></i>
        </a>
        <ul class="menu scylla-dropdown__content">
            
                
            
                
                    <li>
                        <a href="../../branch-4.14/use-monitoring/cql-optimization.html">4.14</a>
                    </li>
                
            
                
                    <li>
                        <a href="../../stable/use-monitoring/cql-optimization.html">4.13</a>
                    </li>
                
            
                
                    <li>
                        <a href="../../branch-4.12/use-monitoring/cql-optimization.html">4.12</a>
                    </li>
                
            
                
                    <li>
                        <a href="../../branch-4.11/use-monitoring/cql-optimization.html">4.11</a>
                    </li>
                
            
                
                    <li>
                        <a href="../../branch-4.10/use-monitoring/cql-optimization.html">4.10</a>
                    </li>
                
            
                
                    <li>
                        <a href="../../branch-4.9/use-monitoring/cql-optimization.html">4.9</a>
                    </li>
                
            
                
                    <li>
                        <a href="../../branch-4.8/use-monitoring/cql-optimization.html">4.8</a>
                    </li>
                
            
                
                    <li>
                        <a href="../../branch-4.7/use-monitoring/cql-optimization.html">4.7</a>
                    </li>
                
            
                
                    <li>
                        <a href="../../branch-4.6/use-monitoring/cql-optimization.html">4.6</a>
                    </li>
                
            
                
                    <li>
                        <a href="../../branch-4.5/use-monitoring/cql-optimization.html">4.5</a>
                    </li>
                
            
                
                    <li>
                        <a href="../../branch-4.4/use-monitoring/cql-optimization.html">4.4</a>
                    </li>
                
            
                
                    <li>
                        <a href="../../branch-4.3/index.html">4.3</a>
                    </li>
                
            
                
                    <li>
                        <a href="../../branch-4.2/index.html">4.2</a>
                    </li>
                
            
                
                    <li>
                        <a href="../../branch-4.1/index.html">4.1</a>
                    </li>
                
            
                
                    <li>
                        <a href="../../branch-4.0/index.html">4.0</a>
                    </li>
                
            
                
                    <li>
                        <a href="../../branch-3.10/index.html">3.10</a>
                    </li>
                
            
                
                    <li>
                        <a href="../../branch-3.9/index.html">3.9</a>
                    </li>
                
            
                
                    <li>
                        <a href="../../branch-3.8/index.html">3.8</a>
                    </li>
                
            
                
                    <li>
                        <a href="../../branch-3.7/index.html">3.7</a>
                    </li>
                
            
                
                    <li>
                        <a href="../../branch-3.6/index.html">3.6</a>
                    </li>
                
            
                
                    <li>
                        <a href="../../branch-3.5/index.html">3.5</a>
                    </li>
                
            
            
        </ul>
    </li>
</ul></div>
        <div class="side-nav__content">
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../intro.html">Introduction</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../install/index.html">Download and Install</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label for="toctree-checkbox-1"><i class="icon-chevron-right"></i></label><div class="break"></div><ul>
<li class="toctree-l2"><a class="reference internal" href="../install/monitoring-stack.html">Install</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install/start-all.html">The start-all.sh script</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install/monitor-without-docker.html">Deploy without Docker</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install/docker-compose.html">Docker Compose</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install/min-prod-hw.html">System Recommendations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install/thanos.html">Using Thanos</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="index.html">User Guide</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label for="toctree-checkbox-2"><i class="icon-chevron-right"></i></label><div class="break"></div><ul class="current">
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">CQL Optimization Dashboard</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="advisor/index.html">Advisor</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label for="toctree-checkbox-3"><i class="icon-chevron-right"></i></label><div class="break"></div><ul>
<li class="toctree-l3"><a class="reference internal" href="advisor/cqlAllowFiltering.html">Some queries use ALLOW FILTERING</a></li>
<li class="toctree-l3"><a class="reference internal" href="advisor/cqlCLAll.html">Some queries use Consistency Level: ALL</a></li>
<li class="toctree-l3"><a class="reference internal" href="advisor/cqlCLAny.html">Some queries use Consistency Level: ANY</a></li>
<li class="toctree-l3"><a class="reference internal" href="advisor/cqlNoTokenAware.html">Some queries are not token-aware</a></li>
<li class="toctree-l3"><a class="reference internal" href="advisor/cqlNonPaged.html">Some SELECT queries are non-paged</a></li>
<li class="toctree-l3"><a class="reference internal" href="advisor/cqlNonPrepared.html">Some queries are non-prepared</a></li>
<li class="toctree-l3"><a class="reference internal" href="advisor/heavyCompaction.html">Compaction takes lots of memory and CPU</a></li>
<li class="toctree-l3"><a class="reference internal" href="advisor/nodeCLErrors.html">Some operation failed due to unsatisfied consistency level</a></li>
<li class="toctree-l3"><a class="reference internal" href="advisor/nodeIOErrors.html">I/O Errors can indicate a node with a faulty disk</a></li>
<li class="toctree-l3"><a class="reference internal" href="advisor/nodeLocalErrors.html">Some operations failed on the replica side</a></li>
<li class="toctree-l3"><a class="reference internal" href="advisor/nonBalancedcqlTraffic.html">CQL queries are not balanced among shards</a></li>
<li class="toctree-l3"><a class="reference internal" href="advisor/preparedCacheEviction.html">Prepared statements cache eviction</a></li>
<li class="toctree-l3"><a class="reference internal" href="advisor/systemOverload.html">System Overload</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../procedures/index.html">Procedures</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label for="toctree-checkbox-4"><i class="icon-chevron-right"></i></label><div class="break"></div><ul>
<li class="toctree-l2"><a class="reference internal" href="../procedures/datadog/cloud-integration.html">Cloud Users Datadog integration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../procedures/datadog/index.html">Datadog Integration</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../procedures/alerts/index.html">Alert Manager</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label for="toctree-checkbox-5"><i class="icon-chevron-right"></i></label><div class="break"></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../procedures/alerts/alerting.html">Alerting</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../procedures/updating-dashboard.html">Adding and Modifying Dashboards</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../upgrade/index.html">Upgrade Guides</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/><label for="toctree-checkbox-6"><i class="icon-chevron-right"></i></label><div class="break"></div><ul>
<li class="toctree-l3"><a class="reference internal" href="../upgrade/upgrade-guide-from-monitoring-4.x-to-monitoring-4.y.html">Monitoring 4.x to 4.y</a></li>
<li class="toctree-l3"><a class="reference internal" href="../upgrade/upgrade-guide-from-monitoring-3.x-to-monitoring-4.y.html">Monitoring 3.x to 4.y</a></li>
<li class="toctree-l3"><a class="reference internal" href="../upgrade/upgrade-guide-from-monitoring-3.x-to-monitoring-3.y.html">Monitoring 3.x to 3.y</a></li>
<li class="toctree-l3"><a class="reference internal" href="../upgrade/upgrade-guide-from-monitoring-2.x-to-monitoring-3.y.html">Monitoring 2.x to 3.y</a></li>
<li class="toctree-l3"><a class="reference internal" href="../upgrade/upgrade-guide-from-monitoring-2.x-to-monitoring-2.y.html">Monitoring 2.x to 2.y</a></li>
<li class="toctree-l3"><a class="reference internal" href="../upgrade/upgrade-guide-from-monitoring-1.x-to-monitoring-2.x.html">Monitoring 1.x to 2.x</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../upgrade/index.html">Upgrade</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/><label for="toctree-checkbox-7"><i class="icon-chevron-right"></i></label><div class="break"></div><ul>
<li class="toctree-l2"><a class="reference internal" href="../upgrade/upgrade-guide-from-monitoring-4.x-to-monitoring-4.y.html">Monitoring 4.x to 4.y</a></li>
<li class="toctree-l2"><a class="reference internal" href="../upgrade/upgrade-guide-from-monitoring-3.x-to-monitoring-4.y.html">Monitoring 3.x to 4.y</a></li>
<li class="toctree-l2"><a class="reference internal" href="../upgrade/upgrade-guide-from-monitoring-3.x-to-monitoring-3.y.html">Monitoring 3.x to 3.y</a></li>
<li class="toctree-l2"><a class="reference internal" href="../upgrade/upgrade-guide-from-monitoring-2.x-to-monitoring-3.y.html">Monitoring 2.x to 3.y</a></li>
<li class="toctree-l2"><a class="reference internal" href="../upgrade/upgrade-guide-from-monitoring-2.x-to-monitoring-2.y.html">Monitoring 2.x to 2.y</a></li>
<li class="toctree-l2"><a class="reference internal" href="../upgrade/upgrade-guide-from-monitoring-1.x-to-monitoring-2.x.html">Monitoring 1.x to 2.x</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../troubleshooting/index.html">Troubleshooting</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/><label for="toctree-checkbox-8"><i class="icon-chevron-right"></i></label><div class="break"></div><ul>
<li class="toctree-l2"><a class="reference internal" href="../troubleshooting/monitor-troubleshoot.html">Troubleshooting</a></li>
<li class="toctree-l2"><a class="reference external" href="https://docs.scylladb.com/troubleshooting/manager_monitoring_integration/">Troubleshooting Guide for Scylla Manager and Scylla Monitor Integration</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../reference/index.html">Reference</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/><label for="toctree-checkbox-9"><i class="icon-chevron-right"></i></label><div class="break"></div><ul>
<li class="toctree-l2"><a class="reference internal" href="../reference/matrix.html">Support Matrix</a></li>
<li class="toctree-l2"><a class="reference internal" href="../reference/monitoring-apis.html">Interfaces</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/scylladb/scylla-monitoring/">GitHub Project</a></li>
</ul>

        </div>
    </div>
</div>
                    
                
            </div>

        </section>

        <footer class="footer">
    <div class="footer-group">
        <div class="footer-top">
            <a class="footer-logo" href="https://www.scylladb.com"></a>
            <div class="footer-links">
                <a class="footer-links__link" href="https://docs.scylladb.com/" target="_blank">Docs</a>
                <a class="footer-links__link" href="https://docs.scylladb.com/stable/get-started/develop-with-scylladb/tutorials-example-projects.html" target="_blank">Tutorials</a>
                <a class="footer-links__link" href="https://university.scylladb.com/" target="_blank">University</a>
                <a class="footer-links__link" href="https://www.scylladb.com/company/contact-us/"
                   target="_blank">Contact Us</a>
                <a class="footer-links__link" href="https://www.scylladb.com/company/" target="_blank">About Us</a>
            </div>
            <div class="footer-actions">
                <a class="footer-actions__link" href="http://slack.scylladb.com/" target="_blank">
                    <span data-tooltip tabindex="1" title="User Slack channel" data-position="bottom">
                        <i class="icon-slack"></i>
                    </span>
                </a>
                <a class="footer-actions__link" href="https://forum.scylladb.com/" target="_blank">
                    <span data-tooltip tabindex="1" title="Community forum" data-position="bottom">
                        <i class="icon-docs-community"></i>
                    </span>
                </a>
            </div>
        </div>

        
            <div class="footer-copyright">
                
                    
                        &#169; 2026, ScyllaDB. All rights reserved.
                    
                    | <a class="footer-copyright__link" href="https://www.scylladb.com/tos/" target="_blank">Terms of Service</a>
                    | <a class="footer-copyright__link" href="https://www.scylladb.com/privacy/" target="_blank">Privacy Policy</a>
                    | ScyllaDB, and ScyllaDB Cloud, are registered trademarks of ScyllaDB, Inc.
                
            </div>
        


        <div class="footer-bottom">
            
                <div class="footer-bottom__last-updated">
                    
                        Last updated on 22 February 2026.
                    
                </div>
            
            <div class="footer-bottom__version">
                Powered by
                <a class="footer-bottom__link" href="http://sphinx-doc.org/">Sphinx 7.4.7</a> &amp;
                <a class="footer-bottom__link" href="https://sphinx-theme.scylladb.com/">ScyllaDB Theme 1.8.10</a>
            </div>
        </div>
    </div>
    
        <biel-button class="footer-ask-ai" project="ddfdo8m94k"
                     header-title="ScyllaDB chatbot (beta)"
                     button-position="bottom-right"
                     modal-position="bottom-right"
                     button-style="dark">
            Ask AI
        </biel-button>
    
</footer>

        <noscript>
            <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T8P2JP" height="0" width="0"
                    style="display: none; visibility: hidden"></iframe>
        </noscript>
    </body>

</html>
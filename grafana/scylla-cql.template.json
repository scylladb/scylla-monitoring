{
    "dashboard": {
        "class": "dashboard",
        "uid": "cql-__SCYLLA_VERSION_DASHED__",
        "originalTitle": "CQL",
        "rows": [
            {
                "class": "row",
                "panels": [
                    {
                        "class": "collapsible_row_panel",
                        "title": ""
                    }
                ]
            },
            {
                "class": "logo_row"
            },
            {
                "class": "row",
                "panels": [
                    {
                        "class": "collapsible_row_panel",
                        "title": "CQL By User"
                    }
                ]
            },
            {
                "class": "row",
                "height": "25px",
                "gridPos": {"h": 2},
                "panels": [
                    {
                        "class": "text_panel",
                        "options": {
                            "content": "<h1 style=\"color:#5780C1; border-bottom: 3px solid #5780C1;\">CQL By User - Coordinator</h1>",
                            "mode": "html"
                        },
                        "style": {}
                    }
                ],
                "title": "New row"
            },
            {
                "class": "row",
                "panels": [
                    {
                        "class": "ops_panel",
                        "span": 3,
                        "targets": [
                            {
                                "expr": "sum(rate(scylla_cql_inserts{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\"}[1m])) by ([[by]]) - sum(rate(scylla_cql_inserts_per_ks{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\", who=\"internal\"}[1m])) by ([[by]])",
                                "intervalFactor": 1,
                                "legendFormat": "",
                                "metric": "",
                                "refId": "A",
                                "step": 1
                            }
                        ],
                        "description": "Number of CQL INSERT commands generated by the user",
                        "description": "scylla_cql_inserts",
                        "title": "CQL Insert"
                    },
                    {
                        "class": "ops_panel",
                        "span": 3,
                        "targets": [
                            {
                                "expr": "sum(rate(scylla_cql_reads{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\"}[1m])) by ([[by]]) - sum(rate(scylla_cql_reads_per_ks{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\", who=\"internal\"}[1m])) by ([[by]])",
                                "intervalFactor": 1,
                                "legendFormat": "",
                                "metric": "",
                                "refId": "A",
                                "step": 1
                            }
                        ],
                        "description": "Number of CQL SELECT commands generated by the user",
                        "title": "CQL Reads"
                    },
                    {
                        "class": "ops_panel",
                        "span": 3,
                        "targets": [
                            {
                                "expr": "sum(rate(scylla_cql_deletes{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\"}[1m])) by ([[by]])-sum(rate(scylla_cql_deletes_per_ks{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\", who=\"internal\"}[1m])) by ([[by]])",
                                "intervalFactor": 1,
                                "legendFormat": "",
                                "metric": "",
                                "refId": "A",
                                "step": 1
                            }
                        ],
                        "description": "Number of CQL DELETE commands generated by the user",
                        "description": "scylla_cql_deletes",
                        "title": "CQL Deletes"
                    },
                    {
                        "class": "ops_panel",
                        "span": 3,
                        "targets": [
                            {
                                "expr": "sum(rate(scylla_cql_updates{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\"}[1m])) by ([[by]])-sum(rate(scylla_cql_updates_per_ks{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\", who=\"internal\"}[1m])) by ([[by]])",
                                "intervalFactor": 1,
                                "legendFormat": "",
                                "metric": "",
                                "refId": "A",
                                "step": 1
                            }
                        ],
                        "description": "Number of CQL UPDATE commands generated by the user",
                        "description": "scylla_cql_updates",
                        "title": "CQL Updates"
                    },
                    {
                        "class": "graph_panel",
                        "span": 3,
                        "pointradius": 1,
                        "targets": [
                            {
                                "expr": "sum(scylla_transport_current_connections{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\"}) by ([[by]])",
                                "intervalFactor": 1,
                                "legendFormat": "",
                                "metric": "",
                                "refId": "A",
                                "step": 30
                            }
                        ],
                        "title": "Client CQL connections by [[by]]",
                        "description": "amount of CQL connections currently established"
                    },
                    {
                        "class": "graph_panel",
                        "span": 3,
                        "pointradius": 1,
                        "targets": [
                            {
                                "expr": "sum(rate(scylla_cql_batches{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\"}[1m])) by ([[by]])",
                                "intervalFactor": 1,
                                "legendFormat": "",
                                "metric": "",
                                "refId": "A",
                                "step": 30
                            }
                        ],
                        "title": "CQL Batches by [[by]]",
                        "description": "Number of CQL batches command, each batched command is counted once"
                    },
                    {
                        "class": "graph_panel",
                        "span": 3,
                        "pointradius": 1,
                        "targets": [
                            {
                                "expr": "sum(rate(scylla_cql_statements_in_batches{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\"}[1m])) by ([[by]])",
                                "intervalFactor": 1,
                                "legendFormat": "",
                                "metric": "",
                                "refId": "A",
                                "step": 30
                            }
                        ],
                        "title": "CQL Command In Batches by [[by]]",
                        "description": "Number of CQL command batched. Each batch would add the number of commands inside the batch"
                    },
                    {
                        "class": "ops_panel",
                        "description": "Counts the number of SELECT statements with BYPASS CACHE option",
                        "span": 3,
                        "targets": [
                            {
                                "expr": "sum(rate(scylla_cql_select_bypass_caches{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\"}[1m])) by ([[by]])",
                                "format": "time_series",
                                "hide": false,
                                "intervalFactor": 2,
                                "refId": "A"
                            }
                        ],
                        "title": "BYPASS CACHE"
                    },
                    {
                        "class": "graph_panel",
                        "span": 3,
                        "pointradius": 1,
                        "targets": [
                            {
                                "expr": "sum(rate(scylla_transport_cql_errors_total{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\"}[1m])) by ([[by]],type) >0",
                                "intervalFactor": 1,
                                "legendFormat": "",
                                "metric": "",
                                "refId": "A",
                                "step": 30
                            }
                        ],
                        "title": "CQL Errors [[by]]",
                        "description": "CQL errors by type, only active errors are shown",
                        "dashversion":[">4.4", ">2021.1"]
                    },
                    {
                        "class": "graph_panel",
                        "span": 3,
                        "pointradius": 1,
                        "targets": [
                            {
                                "expr": "sum(rate(scylla_cql_rows_read{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\"}[1m])) by ([[by]])",
                                "intervalFactor": 1,
                                "legendFormat": "",
                                "metric": "",
                                "refId": "A",
                                "step": 30
                            }
                        ],
                        "title": "CQL Row Reads [[by]]",
                        "description": "Number of CQL row reads"
                    },
                    {
                        "class": "graph_panel",
                        "span": 3,
                        "pointradius": 1,
                        "targets": [
                            {
                                "expr": "sum(rate(scylla_cql_secondary_index_reads{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\"}[1m])) by ([[by]])",
                                "intervalFactor": 1,
                                "legendFormat": "",
                                "metric": "",
                                "refId": "A",
                                "step": 30
                            }
                        ],
                        "title": "Secondary indexes Reads [[by]]",
                        "description": "Number of reads using secondary indexes"
                    }
                ],
                "title": "New row"
            },
            {
                "class": "row",
                "height": "25px",
                "gridPos": {"h": 3},
                "dashproductreject": "no-cql-connection",
                "panels": [
                    {
                        "class": "text_panel",
                        "options": {
                            "content": "<span style=\"color:#5780C1;font-size: 2rem;\">CQL System tables</span></br><span style=\"\">The following information is based on Scylla Plugin configuration, check the </span><a target=\"_blank\" herf=\"https://monitoring.docs.scylladb.com/stable/install/monitor-without-docker.html#using-scylla-plugin-with-grafana\" onclick=\"window.open('https://monitoring.docs.scylladb.com/stable/install/monitor-without-docker.html#using-scylla-plugin-with-grafana', '_blank')\">documentation</a><span> for more details on how to enable it.</span>",
                            "mode": "html"
                        },
                        "style": {}
                    }
                ],
                "title": "New row"
            },
            {
                "class": "row",
                "dashproductreject": "no-cql-connection",
                "panels": [
                    {
                        "class": "collapsible_row_panel",
                        "collapsed": true,
                        "title": "Connection"
                    }
                ]
            },
            {
                "class": "row",
                "dashproductreject": "no-cql-connection",
                "panels": [
                    {
                        "class": "single_value_table",
                        "datasource": "scylla-datasource",
                        "span":12,
                        "targets": [
                            {
                              "refId": "A",
                              "queryText": "select address, port, shard_id, ssl_enabled, username from system.clients",
                              "queryHost": "$node",
                              "dashversion":["<4.4", "<2020.1"]
                              
                            },
                            {
                              "refId": "A",
                              "queryText": "select address, port, shard_id, connection_stage, client_type, ssl_enabled, username, driver_name, driver_version, protocol_version from system.clients",
                              "queryHost": "$node",
                              "dashversion":[">4.4", ">2020.1"]
                            }
                          ],
                        "title": "Connection Table"
                     }
                ]
            },
            {
                "class": "row",
                "dashproductreject": "no-cql-connection",
                "panels": [
                    {
                        "class": "collapsible_row_panel",
                        "collapsed": true,
                        "title": "Large Rows"
                    }
                ]
            },
            {
                "class": "row",
                "dashproductreject": "no-cql-connection",
                "panels": [
                    {
                        "class": "single_value_table",
                        "datasource": "scylla-datasource",
                        "span":12,
                        "targets": [
                            {
                              "refId": "A",
                              "queryText": "select keyspace_name, table_name,partition_key, clustering_key, row_size  from system.large_rows",
                              "queryHost": "$node"
                            }
                          ],
                        "fieldConfig": {
                            "defaults": {
                              "custom": {
                                "align": null,
                                "filterable": false
                              },
                              "thresholds": {
                                "mode": "absolute",
                                "steps": [
                                  {
                                    "value": null,
                                    "color": "green"
                                  },
                                  {
                                    "value": 80,
                                    "color": "red"
                                  }
                                ]
                              },
                              "mappings": []
                            },
                            "overrides": [
                              {
                                "matcher": {
                                  "id": "byName",
                                  "options": "row_size"
                                },
                                "properties": [
                                  {
                                    "id": "unit",
                                    "value": "bytes"
                                  }
                                ]
                              }
                              ]
                        },
                        "title": "Large Rows"
                     }
                ]
            },
            {
                "class": "row",
                "dashproductreject": "no-cql-connection",
                "panels": [
                    {
                        "class": "collapsible_row_panel",
                        "collapsed": true,
                        "title": "Large Cells"
                    }
                ]
            },
            {
                "class": "row",
                "dashproductreject": "no-cql-connection",
                "panels": [
                    {
                        "class": "single_value_table",
                        "datasource": "scylla-datasource",
                        "span":12,
                        "targets": [
                            {
                              "refId": "A",
                              "queryText": "select keyspace_name, table_name,partition_key, clustering_key,  column_name,cell_size  from system.large_cells",
                              "queryHost": "$node"
                            }
                          ],
                        "fieldConfig": {
                            "defaults": {
                              "custom": {
                                "align": null,
                                "filterable": false
                              },
                              "thresholds": {
                                "mode": "absolute",
                                "steps": [
                                  {
                                    "value": null,
                                    "color": "green"
                                  },
                                  {
                                    "value": 80,
                                    "color": "red"
                                  }
                                ]
                              },
                              "mappings": []
                            },
                            "overrides": [
                              {
                                "matcher": {
                                  "id": "byName",
                                  "options": "cell_size"
                                },
                                "properties": [
                                  {
                                    "id": "unit",
                                    "value": "bytes"
                                  }
                                ]
                              }
                              ]
                        },
                        "title": "Large Cells"
                     }
                ]
            },
            {
                "class": "row",
                "dashproductreject": "no-cql-connection",
                "panels": [
                    {
                        "class": "collapsible_row_panel",
                        "collapsed": true,
                        "title": "Large Partitions"
                    }
                ]
            },
            {
                "class": "row",
                "dashproductreject": "no-cql-connection",
                "panels": [
                    {
                        "class": "single_value_table",
                        "datasource": "scylla-datasource",
                        "span":12,
                        "targets": [
                            {
                              "refId": "A",
                              "queryText": "select keyspace_name, table_name,partition_key, partition_size  from system.large_partitions",
                              "queryHost": "$node"
                            }
                          ],
                        "fieldConfig": {
                            "defaults": {
                              "custom": {
                                "align": null,
                                "filterable": false
                              },
                              "thresholds": {
                                "mode": "absolute",
                                "steps": [
                                  {
                                    "value": null,
                                    "color": "green"
                                  },
                                  {
                                    "value": 80,
                                    "color": "red"
                                  }
                                ]
                              },
                              "mappings": []
                            },
                            "overrides": [
                              {
                                "matcher": {
                                  "id": "byName",
                                  "options": "partition_size"
                                },
                                "properties": [
                                  {
                                    "id": "unit",
                                    "value": "bytes"
                                  }
                                ]
                              }
                              ]
                        },
                        "title": "Large Partitions"
                     }
                ]
            },
            {
                "class": "row",
                "panels": [
                    {
                        "class": "collapsible_row_panel",
                        "collapsed": true,
                        "title": "CQL Internal"
                    }
                ]
            },
            {
                "class": "row",
                "height": "25px",
                "gridPos": {"h": 2},
                "panels": [
                    {
                        "class": "text_panel",
                        "options": {
                            "content": "<h1 style=\"color:#5780C1; border-bottom: 3px solid #5780C1;\">CQL Internal - Coordinator</h1>",
                            "mode": "html"
                        },
                        "style": {}
                    }
                ],
                "title": "New row"
            },
            {
                "class": "row",
                "panels": [
                    {
                        "class": "ops_panel",
                        "span": 3,
                        "targets": [
                            {
                                "expr": "sum(rate(scylla_cql_inserts_per_ks{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\", who=\"internal\"}[1m])) by ([[by]])",
                                "intervalFactor": 1,
                                "legendFormat": "",
                                "metric": "",
                                "refId": "A",
                                "step": 1
                            }
                        ],
                        "description": "Number of CQL INSERT commands generated by intenal operations",
                        "title": "CQL Internal Insert"
                    },
                    {
                        "class": "ops_panel",
                        "span": 3,
                        "targets": [
                            {
                                "expr": "sum(rate(scylla_cql_reads_per_ks{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\", who=\"internal\"}[1m])) by ([[by]])",
                                "intervalFactor": 1,
                                "legendFormat": "",
                                "metric": "",
                                "refId": "A",
                                "step": 1
                            }
                        ],
                        "description": "Number of CQL SELECT commands generated by intenal operations",
                        "title": "CQL Internal Reads"
                    },
                    {
                        "class": "ops_panel",
                        "span": 3,
                        "targets": [
                            {
                                "expr": "sum(rate(scylla_cql_deletes_per_ks{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\", who=\"internal\"}[1m])) by ([[by]])",
                                "intervalFactor": 1,
                                "legendFormat": "",
                                "metric": "",
                                "refId": "A",
                                "step": 1
                            }
                        ],
                        "description": "Number of CQL DELETE commands generated by intenal operations",
                        "description": "scylla_cql_deletes",
                        "title": "CQL Deletes"
                    },
                    {
                        "class": "ops_panel",
                        "span": 3,
                        "targets": [
                            {
                                "expr": "sum(rate(scylla_cql_updates_per_ks{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\", who=\"internal\"}[1m])) by ([[by]])",
                                "intervalFactor": 1,
                                "legendFormat": "",
                                "metric": "",
                                "refId": "A",
                                "step": 1
                            }
                        ],
                        "description": "Number of CQL UPDATE commands generated by intenal operations",
                        "description": "scylla_cql_updates",
                        "title": "CQL Updates"
                    }
                ],
                "title": "New row"
            },
            {
                "class": "row",
                "panels": [
                    {
                        "class": "collapsible_row_panel",
                        "title": "LWT"
                    }
                ]
            },
            {
                "class": "row",
                "height": "25px",
                "gridPos": {"h": 2},
                "panels": [
                    {
                        "class": "text_panel",
                        "options": {
                            "content": "<h1 style=\"color:#5780C1; border-bottom: 3px solid #5780C1;\">LWT</h1>",
                            "mode": "html"
                        },
                        "style": {}
                    }
                ],
                "title": "New row"
            },
            {
                "class": "row",
                "panels": [
                    {
                        "class": "ops_panel",
                        "span": 3,
                        "targets": [
                            {
                                "expr": "sum(rate(scylla_cql_inserts{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\", conditional=\"yes\"}[1m])) by ([[by]])",
                                "intervalFactor": 1,
                                "legendFormat": "",
                                "metric": "",
                                "refId": "A",
                                "step": 1
                            }
                        ],
                        "description": "scylla_cql_inserts",
                        "title": "CQL Insert"
                    },
                    {
                        "class": "ops_panel",
                        "span": 3,
                        "targets": [
                            {
                                "expr": "sum(rate(scylla_cql_deletes{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\", conditional=\"yes\"}[1m])) by ([[by]])",
                                "intervalFactor": 1,
                                "legendFormat": "",
                                "metric": "",
                                "refId": "A",
                                "step": 1
                            }
                        ],
                        "description": "scylla_cql_deletes",
                        "title": "CQL Deletes"
                    },
                    {
                        "class": "ops_panel",
                        "span": 3,
                        "targets": [
                            {
                                "expr": "sum(rate(scylla_cql_updates{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\", conditional=\"yes\"}[1m])) by ([[by]])",
                                "intervalFactor": 1,
                                "legendFormat": "",
                                "metric": "",
                                "refId": "A",
                                "step": 1
                            }
                        ],
                        "description": "scylla_cql_updates",
                        "title": "CQL Updates"
                    },
                    {
                        "class": "graph_panel",
                        "span": 3,
                        "pointradius": 1,
                        "targets": [
                            {
                                "expr": "sum(rate(scylla_cql_batches{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\", conditional=\"yes\"}[1m])) by ([[by]])",
                                "intervalFactor": 1,
                                "legendFormat": "",
                                "metric": "",
                                "refId": "A",
                                "step": 30
                            }
                        ],
                        "title": "CQL Batches by [[by]]",
                        "description": "Number of CQL batches command, each batched command is counted once"
                    }
                ],
                "title": "New row"
            },
            {
                "class": "row",
                "panels": [
                    {
                        "class": "collapsible_row_panel",
                        "title": "Optimization"
                    }
                ]
            },
            {
                "class": "row",
                "height": "25px",
                "gridPos": {"h": 2},
                "panels": [
                    {
                        "class": "text_panel",
                        "options": {
                            "content": "<h1 style=\"color:#5780C1; border-bottom: 3px solid #5780C1;\">Optimization</h1>",
                            "mode": "html"
                        },
                        "style": {}
                    }
                ],
                "title": "New row"
            },
            {
                "class": "row",
                "panels": [

                    {
                        "class": "gauge_errors_panel",
                        "description": "All of the requests should be prepared\n\nPrepared statements remove the overhead of parsing the query every time and allow optimal routing of requests from client to server",
                        "targets": [
                            {
                                "expr": "floor(100 *sum(cql:non_system_prepared1m)/ (sum(cql:all_shardrate1m{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\"}) - sum(cql:all_system_shardrate1m{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\"}))) OR vector(0)",
                                "format": "time_series",
                                "hide": false,
                                "instant": false,
                                "interval": "",
                                "intervalFactor": 1,
                                "legendFormat": "",
                                "refId": "A"
                            }
                        ],
                        "title": "CQL Non-Prepared Statements"
                    },
                    {
                        "class": "ops_panel",
                        "description": "All of the requests should be prepared\n",
                        "span": 3,
                        "targets": [
                            {
                                "expr": "sum(cql:non_system_prepared1m{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\"}) by ([[by]])",
                                "format": "time_series",
                                "hide": false,
                                "intervalFactor": 2,
                                "refId": "A"
                            }
                        ],
                        "title": "CQL Non-Prepared Statements"
                    },
                    {
                        "class": "gauge_errors_panel",
                        "description": "All requests should be paged\n\nNon Paged request sources:\n- Client modifying the fetch size\n\nNon Paged requests require reading all the results and returning them in a single request.",
                        "targets": [
                            {
                                "expr": "100 * ((sum(rate(scylla_cql_unpaged_select_queries{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\"}[1m]))-sum(rate(scylla_cql_unpaged_select_queries_per_ks{ks=\"system\",instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\"}[1m])) by ([[by]]))/sum(rate(scylla_cql_reads{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\"}[1m]))) OR vector(0)",
                                "format": "time_series",
                                "hide": false,
                                "instant": false,
                                "interval": "",
                                "intervalFactor": 1,
                                "legendFormat": "",
                                "refId": "A"
                            }
                        ],
                        "title": "Non-Paged CQL Reads"
                    },
                    {
                        "class": "ops_panel",
                        "span": 3,
                        "description": "Non-Paged requests require reading all the results and returning them in a single request",
                        "targets": [
                            {
                                "expr": "sum(rate(scylla_cql_unpaged_select_queries{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\"}[1m])) by ([[by]])-sum(rate(scylla_cql_unpaged_select_queries_per_ks{ks=\"system\",instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\"}[1m])) by ([[by]])",
                                "format": "time_series",
                                "hide": false,
                                "intervalFactor": 2,
                                "refId": "A"
                            }
                        ],
                        "title": "Non-Paged CQL Reads"
                    },
                    {
                        "class": "gauge_errors_panel",
                        "description": "All of the requests should be Token Aware\n\nNon Token Aware requests sources:\n* Non-Prepared Stamements\n* Client not using a Token Aware load balancing policy\n\nTokenAware requests are sent to a Scylla node that is also a replica. Token Un-Aware requests require extra hop and additional processing.\n\nNote that the metric shows incorrect values when batches are used.",
                        "targets": [
                            {
                                "expr": "scalar(sum(rate(scylla_storage_proxy_coordinator_cas_total_operations{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]|$^\"}[1m])) <=bool 0)*scalar(sum(rate(scylla_storage_proxy_replica_received_counter_updates{cluster=~\"$cluster|$^\"}[1m]))<=bool 0) *(100 - clamp_max(100*(sum(rate(scylla_storage_proxy_coordinator_reads_local_node{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\"}[1m])) + sum(rate(scylla_storage_proxy_coordinator_total_write_attempts_local_node{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\"}[1m])))/(sum(rate(scylla_cql_inserts{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\"}[1m])) +sum(rate(scylla_cql_updates{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\"}[1m])) +sum(rate(scylla_cql_deletes{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\"}[1m])) +sum(rate(scylla_cql_reads{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\"}[1m]))) + 1,100)) OR vector(0)",
                                "format": "time_series",
                                "hide": false,
                                "intervalFactor": 1,
                                "legendFormat": "",
                                "refId": "A"
                            }
                        ],
                        "title": "Non-Token Aware"
                    },
                    {
                        "class": "ops_panel",
                        "description": "Requests that are not token aware indicates that requests are not routed to the right node, which require extra hop and additional processing.\n\nNote that the metric shows incorrect values when batches are used.",
                        "span": 3,
                        "targets": [
                            {
                                "expr": "scalar(sum(rate(scylla_storage_proxy_coordinator_cas_total_operations{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]|$^\"}[1m])) <=bool 0)*scalar(sum(rate(scylla_storage_proxy_replica_received_counter_updates{cluster=~\"$cluster|$^\"}[1m]))<=bool 0) *clamp_min(sum(rate(scylla_cql_reads{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\"}[1m])) by ([[by]]) - sum(rate(scylla_storage_proxy_coordinator_reads_local_node{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\"}[1m])) by ([[by]]) + sum(rate(scylla_cql_inserts{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\"}[1m]) + rate(scylla_cql_updates{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\"}[1m]) + rate(scylla_cql_deletes{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\"}[1m])) by ([[by]]) - sum(rate(scylla_storage_proxy_coordinator_total_write_attempts_local_node{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\"}[1m])) by ([[by]]),0)",
                                "format": "time_series",
                                "hide": false,
                                "intervalFactor": 2,
                                "refId": "A"
                            }
                        ],
                        "title": "Non-Token Aware Queries"
                    }
                    ],
                "title": "New row"
            },
            {
                "class": "row",
                "panels": [
                    {
                        "class": "gauge_errors_panel",
                        "description": "Reversed CQL Reads entail additional processing on server side\n\nSources: CQL Read requests with ORDER BY that is different from the \"CLUSTERING ORDER BY\" of the table\nAlternatives:\n\n* Denormalize your data (use a Materialized View)",
                        "targets": [
                            {
                                "expr": "100 * sum(rate(scylla_cql_reverse_queries{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\"}[1m])) / sum(rate(scylla_cql_reads{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\"}[1m])) OR vector(0)",
                                "format": "time_series",
                                "hide": false,
                                "instant": false,
                                "interval": "",
                                "intervalFactor": 1,
                                "legendFormat": "",
                                "refId": "A"
                            }
                        ],
                        "title": "Reversed CQL Reads"
                    },
                    {
                        "class": "ops_panel",
                        "span": 3,
                        "description": "Reversed CQL Reads entail additional processing on server side and should be avoided",
                        "targets": [
                            {
                                "expr": "sum(rate(scylla_cql_reverse_queries{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\"}[1m])) by ([[by]])",
                                "format": "time_series",
                                "hide": false,
                                "intervalFactor": 2,
                                "refId": "A"
                            }
                        ],
                        "title": "Reversed CQL Reads"
                    },
                    {
                        "class": "gauge_errors_panel",
                        "description": "ALLOW FILTERING CQL Reads, the percentage of read requests with 'ALLOW FILTERING'\n\nALLOW FILTERING CQL Reads entail additional processing on server side\n\nSources: CQL Read requests with \"ALLOW FILTERING\"\n\nALLOW FILTERING should be used when large parts of the filtered data is returned - check \n\"ALLOW FILTERING CQL Read Filtered Rows to check what percentage of the data is used\"\n\nAlternatives:\n- Use a Secondary Index\n- Denormalize your data (use a Materialized View)",
                        "targets": [
                            {
                                "expr": "100 * sum(rate(scylla_cql_filtered_read_requests{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\"}[1m])) / sum(rate(scylla_cql_reads{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\"}[1m])) OR vector(0)",
                                "format": "time_series",
                                "hide": false,
                                "intervalFactor": 1,
                                "legendFormat": "",
                                "refId": "A"
                            }
                        ],
                        "title": "ALLOW FILTERING CQL Reads"
                    },
                    {
                        "class": "rps_panel",
                        "span": 3,
                        "description": "Read requests with ALLOW FILTERING\n\nALLOW FILTERING CQL Reads entail additional processing on server side and should be avoided",
                        "targets": [
                            {
                                "expr": "sum(rate(scylla_cql_filtered_read_requests{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\"}[1m])) by ([[by]])",
                                "format": "time_series",
                                "hide": false,
                                "intervalFactor": 2,
                                "refId": "A"
                            }
                        ],
                        "title": "ALLOW FILTERING CQL Reads"
                    },
                    {
                        "class": "gauge_errors_panel",
                        "description": "ALLOW FILTERING Filtered rows, the percentage of rows that were read and then filtered.\n\nALLOW FILTERING CQL Reads entail additional processing on server side. \nReading a row and then filter it is a waste of resources.\n\nSources: CQL Read requests with \"ALLOW FILTERING\"\n\nALLOW FILTERING should be used when large parts of the filtered data is returned\n\nAlternatives:\n- Use a Secondary Index\n- Denormalize your data (use a Materialized View)",
                        "targets": [
                            {
                                "expr": "100 * sum(rate(scylla_cql_filtered_rows_dropped_total{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\"}[1m]))  /sum(rate(scylla_cql_filtered_rows_read_total{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\"}[1m])) OR vector(0)",
                                "format": "time_series",
                                "hide": false,
                                "instant": false,
                                "interval": "",
                                "intervalFactor": 1,
                                "legendFormat": "",
                                "refId": "A"
                            }
                        ],
                        "title": "ALLOW FILTERING Filtered Rows"
                    },
                    {
                        "class": "rps_panel",
                        "span": 3,
                        "description": "CQL Queries with ALLOW FILTERING should be avoided.\nDropped rows are rows that were read but were filtered by the server.\nWhen dropped rows is relatively high you should consider the alternatives",
                        "targets": [
                            {
                                "expr": "sum(rate(scylla_cql_filtered_rows_read_total{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\"}[1m])) by ([[by]])",
                                "format": "time_series",
                                "hide": false,
                                "intervalFactor": 2,
                                "legendFormat": "rows read $node $shard",
                                "refId": "A"
                            },
                            {
                                "expr": "sum(rate(scylla_cql_filtered_rows_matched_total{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\"}[1m])) by ([[by]])",
                                "format": "time_series",
                                "hide": false,
                                "interval": "",
                                "intervalFactor": 2,
                                "legendFormat": "rows matched $node $shard",
                                "refId": "B"
                            },
                            {
                                "expr": "sum(rate(scylla_cql_filtered_rows_dropped_total{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\"}[1m])) by ([[by]])",
                                "format": "time_series",
                                "intervalFactor": 2,
                                "legendFormat": "rows dropped $node $shard",
                                "refId": "C"
                            }
                        ],
                        "title": "ALLOW FILTERING CQL Read Filtering"
                    }
                ],
                "title": "New row"
            },
            {
                "class": "row",
                "panels": [
                    {
                        "class": "gauge_errors_panel",
                        "description": "Range scans should typically by pass the cache.\n\n Add BYPASS CACHE to your select queries.",
                        "targets": [
                            {
                                "expr": "floor(100 *sum(rate(scylla_cql_select_partition_range_scan_no_bypass_cache{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\"}[1m]))/(sum(rate(scylla_cql_reads{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\"}[1m])) - sum(rate(scylla_cql_reads_per_ks{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\", who=\"internal\"}[1m])) )) OR vector(0)",
                                "format": "time_series",
                                "hide": false,
                                "instant": false,
                                "interval": "",
                                "intervalFactor": 1,
                                "legendFormat": "",
                                "refId": "A"
                            }
                        ],
                        "title": "Range Scans"
                    },
                    {
                        "class": "ops_panel",
                        "description": "Range scans should typically by pass the cache.\n\n Add BYPASS CACHE to your select queries.",
                        "span": 3,
                        "targets": [
                            {
                                "expr": "sum(rate(scylla_cql_select_partition_range_scan_no_bypass_cache{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\"}[1m])) by ([[by]])",
                                "format": "time_series",
                                "hide": false,
                                "intervalFactor": 2,
                                "refId": "A"
                            }
                        ],
                        "title": "Range Scans Without BYPASS CACHE "
                    },
                    {
                        "class": "gauge_errors_panel",
                        "description": "Using consistency level ANY in a query may hurt persistency, if the node receiving the request will fail the data may be lost",
                        "targets": [
                            {
                                "expr": "floor(100 *sum(rate(scylla_query_processor_queries{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\", consistency_level=\"ANY\"}[1m]))/sum(rate(scylla_query_processor_queries{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\"}[1m]))) OR vector(0)",
                                "format": "time_series",
                                "hide": false,
                                "instant": false,
                                "interval": "",
                                "intervalFactor": 1,
                                "legendFormat": "",
                                "refId": "A"
                            }
                        ],
                        "title": "CQL ANY Queries"
                    },
                    {
                        "class": "ops_panel",
                        "description": "Using consistency level ANY in a query may hurt persistency, if the node receiving the request will fail the data may be lost",
                        "span": 3,
                        "targets": [
                            {
                                "expr": "sum(rate(scylla_query_processor_queries{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\",  consistency_level=\"ANY\"}[1m])) by ([[by]])",
                                "format": "time_series",
                                "hide": false,
                                "intervalFactor": 2,
                                "refId": "A"
                            }
                        ],
                        "title": "CQL ANY CL Queries"
                    },
                    {
                        "class": "gauge_errors_panel",
                        "description": "Using consistency level ALL in a query may hurt availability, if a node is unavailable operations will fail",
                        "targets": [
                            {
                                "expr": "floor(100 *sum(rate(scylla_query_processor_queries{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\", consistency_level=\"ALL\"}[1m]))/sum(rate(scylla_query_processor_queries{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\"}[1m]))) OR vector(0)",
                                "format": "time_series",
                                "hide": false,
                                "instant": false,
                                "interval": "",
                                "intervalFactor": 1,
                                "legendFormat": "",
                                "refId": "A"
                            }
                        ],
                        "title": "CQL ALL CL Queries"
                    },
                    {
                        "class": "ops_panel",
                        "description": "Using consistency level ALL in a query may hurt availability, if a node is unavailable operations will fail",
                        "span": 3,
                        "targets": [
                            {
                                "expr": "sum(rate(scylla_query_processor_queries{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\",  consistency_level=\"ALL\"}[1m])) by ([[by]])",
                                "format": "time_series",
                                "hide": false,
                                "intervalFactor": 2,
                                "refId": "A"
                            }
                        ],
                        "title": "CQL ALL CL Queries"
                    }

                ]
            },
            {
                "class": "row",
                "height": "25px",
                "gridPos": {"h": 3},
                "panels": [
                    {
                        "class": "text_panel",
                        "options": {
                            "content": "<h1 style=\"color:#5780C1; border-bottom: 3px solid #5780C1;\">Cross DC Information</h1><h5>This section is relevant only if you have more than one DC</h5>",
                            "mode": "html"
                        },
                        "style": {}
                    }
                ],
                "title": "New row"
            },
            {
                "class": "row",
                "panels": [
                    {
                        "class": "gauge_errors_panel",
                        "description": "How many Queries use Consistency level ONE\n\nThis is an issue when using multiple datacenters.\n\nUsing consistency level ONE in a query when there is more than one DC may hurt performance, queries may end in the non-local DC. Use LOCAL_ONE instead",
                        "targets": [
                            {
                                "expr": "floor(100 *sum(rate(scylla_query_processor_queries{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\", consistency_level=\"ONE\"}[1m]))/sum(rate(scylla_query_processor_queries{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\"}[1m]))) OR vector(0)",
                                "format": "time_series",
                                "hide": false,
                                "instant": false,
                                "interval": "",
                                "intervalFactor": 1,
                                "legendFormat": "",
                                "refId": "A"
                            }
                        ],
                        "title": "CQL ONE Queries"
                    },
                    {
                        "class": "ops_panel",
                        "description": "How many Queries use Consistency level ONE\n\nThis is an issue when using multiple datacenters.\n\nUsing consistency level ONE in a query when there is more than one DC may hurt performance, queries may end in the non-local DC. Use LOCAL_ONE instead",
                        "span": 3,
                        "targets": [
                            {
                                "expr": "sum(rate(scylla_query_processor_queries{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\",  consistency_level=\"ONE\"}[1m])) by ([[by]])",
                                "format": "time_series",
                                "hide": false,
                                "intervalFactor": 2,
                                "refId": "A"
                            }
                        ],
                        "title": "CQL ONE CL Queries"
                    },
                    {
                        "class": "gauge_errors_panel",
                        "description": "How many Queries use Consistency level QUORUM\n\nThis is an issue when using multiple datacenters.\n\nUsing consistency level QUORUM in a query when there is more than one DC may hurt performance, queries may end in the non-local DC. Use LOCAL_QUORUM instead",
                        "targets": [
                            {
                                "expr": "floor(100 *sum(rate(scylla_query_processor_queries{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\", consistency_level=\"QUORUM\"}[1m]))/sum(rate(scylla_query_processor_queries{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\"}[1m]))) OR vector(0)",
                                "format": "time_series",
                                "hide": false,
                                "instant": false,
                                "interval": "",
                                "intervalFactor": 1,
                                "legendFormat": "",
                                "refId": "A"
                            }
                        ],
                        "title": "CQL QUORUM CL Queries"
                    },
                    {
                        "class": "ops_panel",
                        "description": "How many Queries use Consistency level QUORUM\n\nThis is an issue when using multiple datacenters.\n\nUsing consistency level QUORUM in a query when there is more than one DC may hurt performance, queries may end in the non-local DC. Use LOCAL_QUORUM instead",
                        "span": 3,
                        "targets": [
                            {
                                "expr": "sum(rate(scylla_query_processor_queries{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\",  consistency_level=\"QUORUM\"}[1m])) by ([[by]])",
                                "format": "time_series",
                                "hide": false,
                                "intervalFactor": 2,
                                "refId": "A"
                            }
                        ],
                        "title": "CQL QUORUM CL Queries"
                    }

                ]
            },
            {
                "class": "row",
                "panels": [
                {
                        "class": "gauge_errors_panel",
                        "repeat": "dc",
                        "span": 2,
                        "description": "Cross DC traffic may cause additional latencies and network loads and in most cases, should be avoided.\n\nCross DC Read requests sources:\n- Consistency Level that is not LOCAL_XXX\n- Tables with read_repair_chance > 0\n\nNote:\n- If requests are supposed to be  DC local - verify client is using a DCAware policy and a LOCAL_XX consistency level",
                        "targets": [
                            {
                                "expr": "100*(sum(rate(scylla_storage_proxy_coordinator_reads_remote_node{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\"}[1m])) - sum(rate(scylla_storage_proxy_coordinator_reads_remote_node{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", datacenter=~\"$dc\", shard=~\"[[shard]]\"}[1m])))/sum(rate(scylla_storage_proxy_coordinator_reads_remote_node{instance=~\"[[node]]\",cluster=~\"$cluster|$^\", dc=~\"$dc\", shard=~\"[[shard]]\"}[1m])) OR vector(0)",
                                "format": "time_series",
                                "intervalFactor": 1,
                                "refId": "A"
                            }
                        ],
                        "title": "Cross DC read requests $dc"
                    }
                ]
            },
            {
                "class": "monitoring_version_row"
            }
        ],
        "tags": [
            "__SCYLLA_VERSION_DOT__"
        ],
        "templating": {
            "list": [
                {
                    "class":"by_template_var"
                },
                {
                    "class": "template_variable_single",
                    "label": "cluster",
                    "name": "cluster",
                    "query": "label_values(scylla_reactor_utilization, cluster)"
                },
                {
                    "class": "template_variable_all",
                    "label": "dc",
                    "name": "dc",
                    "query": "label_values(scylla_reactor_utilization{cluster=~\"$cluster\"}, dc)"
                },
                {
                    "class":"template_variable_single",
                    "current":{
                       "selected":true,
                       "text":[
                          "All"
                       ],
                       "value":[
                          "$__all"
                       ]
                    },
                    "includeAll":true,
                    "multi":true,
                    "label": "node",
                    "name": "node",
                    "query": "label_values(scylla_reactor_utilization{cluster=~\"$cluster|$^\", dc=~\"$dc\"}, instance)"
                },
                {
                    "class": "template_variable_all",
                    "label": "shard",
                    "name": "shard",
                    "query": "label_values(scylla_reactor_utilization,shard)",
                    "sort": 3
                },
                {
                    "class": "template_variable_custom",
                    "current": {
                        "text": "__SCYLLA_VERSION_DASHED__",
                        "value": "__SCYLLA_VERSION_DASHED__"
                    },
                    "name": "dash_version",
                    "options": [
                        {
                            "selected": true,
                            "text": "__SCYLLA_VERSION_DASHED__",
                            "value": "__SCYLLA_VERSION_DASHED__"
                        }
                    ],
                    "query": "__SCYLLA_VERSION_DASHED__"
                },
                {
                    "class": "template_variable_custom",
                    "current": {
                        "text": "__SCYLLA_VERSION_DOT__",
                        "value": "__SCYLLA_VERSION_DOT__"
                    },
                    "name": "scylla_version",
                    "options": [
                        {
                            "selected": true,
                            "text": "__SCYLLA_VERSION_DOT__",
                            "value": "__SCYLLA_VERSION_DOT__"
                        }
                    ],
                    "query": "__SCYLLA_VERSION_DOT__"
                },
                {
                    "class": "monitor_version_var"
                }
            ]
        },
        "time": {
            "from": "now-5m",
            "to": "now"
        },
        "annotations" :{
            "list": [
              {
                "builtIn": 1,
                "datasource": "-- Grafana --",
                "enable": true,
                "hide": true,
                "iconColor": "rgba(0, 211, 255, 1)",
                "name": "Annotations & Alerts",
                "type": "dashboard"
              },
              {
                "class" : "annotation_restart"
              },
              {
                "class" : "annotation_stall"
              },
              {
              "class" : "annotation_schema_changed"
              }
            ]
        },
        "overwrite": true,
        "title": "Scylla CQL"
    }
}
